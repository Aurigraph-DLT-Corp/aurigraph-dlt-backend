# Sprint 18: Quarkus TLS/mTLS Configuration for Aurigraph V11
# Production-grade TLS 1.3 for HTTP, gRPC, and inter-node communication

# ========== HTTP Server Configuration (TLS 1.3) ==========
quarkus.http.ssl.certificate.files=/opt/certs/node-server.crt
quarkus.http.ssl.certificate.key-files=/opt/certs/node-server.key
quarkus.http.ssl.certificate.key-store-format=PEM

# TLS Protocol Configuration
quarkus.http.ssl.protocols=TLSv1.3
quarkus.http.ssl.cipher-suites=TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256

# Session Configuration
quarkus.http.ssl.session-timeout=PT1H

# Enable HTTP/2 with TLS
quarkus.http.http2=true
quarkus.http.alpn=h2,http/1.1

# HTTPS Port
quarkus.http.port=9443

# ========== gRPC Server Configuration (mTLS) ==========
# gRPC runs on separate port with mutual TLS
quarkus.grpc.server.port=9444
quarkus.grpc.server.ssl.certificate=/opt/certs/node-server.crt
quarkus.grpc.server.ssl.key=/opt/certs/node-server.key
quarkus.grpc.server.ssl.trust-store=/opt/certs/ca.crt
quarkus.grpc.server.ssl.trust-store-type=PEM

# Require client certificate verification
quarkus.grpc.server.ssl.client-auth=REQUIRE

# ========== Consensus Node Communication (mTLS) ==========
# For inter-node consensus communication
quarkus.tls.trust-store=/opt/certs/ca.crt
quarkus.tls.trust-store-type=PEM

# Client certificate for outbound connections
quarkus.tls.client-cert=/opt/certs/node-client.crt
quarkus.tls.client-key=/opt/certs/node-client.key

# Cipher suites for consensus
quarkus.tls.cipher-suites=TLS_AES_256_GCM_SHA384,TLS_CHACHA20_POLY1305_SHA256

# ========== gRPC Client Configuration (for inter-node gRPC calls) ==========
quarkus.grpc.clients.consensus.host=localhost
quarkus.grpc.clients.consensus.port=9444
quarkus.grpc.clients.consensus.ssl.trust-certs=/opt/certs/ca.crt
quarkus.grpc.clients.consensus.ssl.client-cert=/opt/certs/node-client.crt
quarkus.grpc.clients.consensus.ssl.client-key=/opt/certs/node-client.key

quarkus.grpc.clients.transaction.host=localhost
quarkus.grpc.clients.transaction.port=9444
quarkus.grpc.clients.transaction.ssl.trust-certs=/opt/certs/ca.crt
quarkus.grpc.clients.transaction.ssl.client-cert=/opt/certs/node-client.crt
quarkus.grpc.clients.transaction.ssl.client-key=/opt/certs/node-client.key

# ========== TLS Certificate Validation ==========
# Verify hostname in certificates
quarkus.tls.verify-hostname=true

# Certificate validation depth
quarkus.tls.verify-depth=2

# Revocation checking (CRL/OCSP)
quarkus.tls.ocsp-stapling.enabled=true
quarkus.tls.crl-check.enabled=true

# ========== Health Check Configuration (TLS) ==========
# Health checks use HTTPS
quarkus.health.enabled=true
quarkus.smallrye.health.root-path=/q/health

# Liveness probe (TLS)
quarkus.health.livenessProbe.enabled=true
quarkus.health.livenessProbe.path=/q/health/live

# Readiness probe (TLS)
quarkus.health.readinessProbe.enabled=true
quarkus.health.readinessProbe.path=/q/health/ready

# ========== Metrics Configuration (TLS) ==========
# Prometheus metrics endpoint (TLS)
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# TLS for metrics endpoint
quarkus.management.port=9443
quarkus.management.ssl.certificate.files=/opt/certs/node-server.crt
quarkus.management.ssl.certificate.key-files=/opt/certs/node-server.key

# ========== Logging Configuration ==========
# Log TLS handshakes for debugging
quarkus.log.category."io.quarkus.tls".level=DEBUG
quarkus.log.category."javax.net.ssl".level=DEBUG

# ========== Security Headers ==========
# Add security headers to all responses
quarkus.http.header.Strict-Transport-Security=max-age=31536000; includeSubDomains; preload
quarkus.http.header.X-Content-Type-Options=nosniff
quarkus.http.header.X-Frame-Options=SAMEORIGIN
quarkus.http.header.X-XSS-Protection=1; mode=block
quarkus.http.header.Referrer-Policy=strict-origin-when-cross-origin

# ========== Connection Configuration ==========
# Connection pooling for inter-node communication
quarkus.datasource.jdbc.max-size=20
quarkus.datasource.jdbc.min-size=5

# Connection timeout
quarkus.datasource.jdbc.new-connection-sql=SELECT 1
quarkus.datasource.jdbc.connection-init-sql=SELECT 1

# ========== Consensus Configuration with TLS ==========
quarkus.application.consensus.enabled=true
quarkus.application.consensus.protocol=HYPERRAFT_PLUS_PLUS
quarkus.application.consensus.tls.enabled=true
quarkus.application.consensus.tls.verify-peer=true
quarkus.application.consensus.tls.verify-hostname=true

# ========== Performance Tuning with TLS ==========
# Disable session tickets for security (requires TLS resumption via session ID)
quarkus.http.ssl.session-ticket=false

# Enable TCP Fast Open (if supported)
quarkus.http.tcp-fast-open=true

# Keep-alive settings
quarkus.http.keep-alive=true
quarkus.http.keep-alive-timeout=PT30S

# Netty settings for TLS
quarkus.netty.buffer-allocator.strategy=directpooled
quarkus.netty.idle-timeout=PT30S
