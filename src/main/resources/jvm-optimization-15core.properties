# JVM Optimization Configuration for 15-Core Intel Xeon Gold + 64GB RAM
# Sprint 5: Memory and GC Optimization for 1.6M+ TPS Target

# ========================================
# JVM Memory Configuration (32GB Heap)
# ========================================

# Heap Memory Settings
jvm.heap.initial.size=8g
jvm.heap.max.size=32g
jvm.heap.new.generation.size=12g
jvm.heap.old.generation.size=20g
jvm.heap.survivor.ratio=8
jvm.heap.new.ratio=3

# Off-Heap Memory Configuration
jvm.offheap.enabled=true
jvm.offheap.max.size=16g
jvm.offheap.initial.size=4g
jvm.offheap.direct.memory.size=8g

# Metaspace Configuration
jvm.metaspace.initial.size=256m
jvm.metaspace.max.size=1g
jvm.compressed.oops.enabled=false

# ========================================
# G1GC Optimization for Large Heap
# ========================================

# G1GC Basic Configuration
jvm.gc.collector=G1GC
jvm.gc.g1.heap.region.size=32m
jvm.gc.g1.max.gc.pause.time=50ms
jvm.gc.g1.gc.threads=15
jvm.gc.g1.concurrent.threads=4

# G1GC Advanced Configuration
jvm.gc.g1.young.gen.size=25
jvm.gc.g1.old.gen.occupancy.threshold=45
jvm.gc.g1.concurrent.mark.thread.count=4
jvm.gc.g1.refinement.threads=15
jvm.gc.g1.refinement.threshold=10
jvm.gc.g1.update.buffer.size=256

# G1GC Mixed Collection Settings
jvm.gc.g1.mixed.gc.count.target=8
jvm.gc.g1.mixed.gc.threshold=65
jvm.gc.g1.old.gen.percent=5
jvm.gc.g1.reserve.percent=10

# G1GC Concurrent Collection
jvm.gc.g1.concurrent.mark.enabled=true
jvm.gc.g1.concurrent.refinement.enabled=true
jvm.gc.g1.concurrent.collection.enabled=true
jvm.gc.g1.incremental.collection.enabled=true

# ========================================
# Memory Management Optimization
# ========================================

# Allocation Optimization
jvm.memory.allocation.prefetch.enabled=true
jvm.memory.allocation.zero.enabled=false
jvm.memory.allocation.thread.local.buffer.size=128k
jvm.memory.allocation.large.object.threshold=32k

# Memory Compaction
jvm.memory.compaction.enabled=true
jvm.memory.compaction.threshold=85
jvm.memory.compaction.parallel.enabled=true
jvm.memory.compaction.concurrent.enabled=true

# String Optimization
jvm.string.deduplication.enabled=true
jvm.string.deduplication.age.threshold=3
jvm.compressed.strings.enabled=true

# ========================================
# NUMA Memory Management
# ========================================

# NUMA Configuration
jvm.numa.enabled=true
jvm.numa.interleave.enabled=false
jvm.numa.preferred.policy=local
jvm.numa.memory.binding=true
jvm.numa.thread.binding=true

# NUMA Memory Pool Configuration
jvm.numa.memory.pools=2
jvm.numa.pool.0.size=16g
jvm.numa.pool.1.size=16g
jvm.numa.pool.interleave.threshold=1m

# ========================================
# Cache-Friendly Memory Layout
# ========================================

# Cache Line Optimization
jvm.cache.line.size=64
jvm.cache.alignment.enabled=true
jvm.cache.prefetch.enabled=true
jvm.cache.prefetch.distance=8

# Object Layout Optimization
jvm.object.alignment.size=8
jvm.object.header.compression=true
jvm.array.alignment.enabled=true
jvm.field.reordering.enabled=true

# ========================================
# Performance Monitoring
# ========================================

# GC Logging and Monitoring
jvm.gc.logging.enabled=true
jvm.gc.logging.detailed=false
jvm.gc.logging.rotation.enabled=true
jvm.gc.logging.max.files=5
jvm.gc.logging.file.size=100m

# Memory Monitoring
jvm.memory.monitoring.enabled=true
jvm.memory.monitoring.interval.ms=5000
jvm.memory.monitoring.threshold.heap=85
jvm.memory.monitoring.threshold.metaspace=80

# JFR Configuration
jvm.jfr.enabled=true
jvm.jfr.duration=1h
jvm.jfr.max.age=24h
jvm.jfr.max.size=1g
jvm.jfr.settings=profile

# ========================================
# JIT Compiler Optimization
# ========================================

# HotSpot Compiler Settings
jvm.compiler.c1.enabled=true
jvm.compiler.c2.enabled=true
jvm.compiler.tiered.compilation=true
jvm.compiler.compilation.threshold=10000
jvm.compiler.background.compilation=true

# Method Inlining
jvm.compiler.inline.size.max=35000
jvm.compiler.inline.size.hot=35000
jvm.compiler.inline.depth.max=9
jvm.compiler.inline.frequency.minimum=325

# Code Cache Optimization
jvm.code.cache.initial.size=256m
jvm.code.cache.max.size=512m
jvm.code.cache.segment.size=128m

# ========================================
# Thread and Concurrency Optimization
# ========================================

# Thread Stack Configuration
jvm.thread.stack.size=1m
jvm.thread.stack.guard.size=64k
jvm.thread.stack.pretouch=true

# Virtual Thread Configuration (Java 21)
jvm.virtual.threads.enabled=true
jvm.virtual.threads.carrier.threads=15
jvm.virtual.threads.scheduler.parallelism=15
jvm.virtual.threads.pool.keep.alive=60s

# ForkJoinPool Configuration
jvm.forkjoin.common.parallelism=15
jvm.forkjoin.common.thread.factory=ForkJoinPool.defaultForkJoinWorkerThreadFactory
jvm.forkjoin.common.exception.handler=null
jvm.forkjoin.pool.size=15

# ========================================
# I/O and Network Optimization
# ========================================

# NIO Configuration
jvm.nio.direct.memory.size=8g
jvm.nio.max.cached.buffer.size=262144
jvm.nio.use.direct.buffers=true
jvm.nio.buffer.pool.size=1024

# Network Buffer Configuration
jvm.network.buffer.size=65536
jvm.network.send.buffer.size=1048576
jvm.network.receive.buffer.size=1048576
jvm.network.tcp.no.delay=true

# ========================================
# Security and Safety Configuration
# ========================================

# Memory Safety
jvm.memory.guard.pages.enabled=true
jvm.memory.bounds.checking.enabled=false
jvm.memory.corruption.detection.enabled=true

# Security Manager
jvm.security.manager.enabled=false
jvm.security.policy=all.policy

# ========================================
# Development and Debugging
# ========================================

# Debug Configuration
jvm.debug.enabled=false
jvm.debug.port=8000
jvm.debug.suspend=false
jvm.debug.server=true

# Profiling
jvm.profiling.enabled=false
jvm.profiling.agent=none
jvm.profiling.options=

# ========================================
# Production Optimizations
# ========================================

# Startup Optimization
jvm.startup.precompile.enabled=true
jvm.startup.class.preloading.enabled=true
jvm.startup.method.warming.enabled=true
jvm.startup.optimization.level=aggressive

# Runtime Optimizations
jvm.runtime.optimization.enabled=true
jvm.runtime.adaptive.sizing=true
jvm.runtime.ergonomics.enabled=true
jvm.runtime.compressed.oops=false

# ========================================
# Platform-Specific Optimizations
# ========================================

# x86_64 Specific
jvm.platform.x86.use.sse=true
jvm.platform.x86.use.avx=true
jvm.platform.x86.use.avx2=true
jvm.platform.x86.prefetch.instructions=true

# Intel Specific
jvm.platform.intel.turbo.boost.enabled=true
jvm.platform.intel.hyper.threading.aware=true
jvm.platform.intel.cache.optimization=true

# ========================================
# Memory Leak Prevention
# ========================================

# Leak Detection
jvm.memory.leak.detection.enabled=true
jvm.memory.leak.detection.threshold=1000
jvm.memory.leak.detection.interval=60s

# Reference Management
jvm.reference.processing.enabled=true
jvm.reference.processing.threads=4
jvm.reference.processing.parallel=true

# ========================================
# Application-Specific Tuning
# ========================================

# Blockchain Specific
jvm.blockchain.transaction.pool.size=10000000
jvm.blockchain.block.cache.size=100000
jvm.blockchain.state.cache.size=1000000
jvm.blockchain.consensus.buffer.size=500000

# High-Frequency Trading Optimizations
jvm.hft.low.latency.gc.enabled=true
jvm.hft.allocation.elimination=true
jvm.hft.escape.analysis.enabled=true
jvm.hft.biased.locking.enabled=false

# ========================================
# Environment-Specific Configuration
# ========================================

# Development Environment
dev.jvm.heap.max.size=16g
dev.jvm.gc.logging.enabled=true
dev.jvm.debug.enabled=true
dev.jvm.profiling.enabled=true
dev.jvm.assertions.enabled=true

# Testing Environment
test.jvm.heap.max.size=8g
test.jvm.gc.aggressive.enabled=true
test.jvm.memory.stress.testing=true
test.jvm.coverage.enabled=true

# Production Environment
prod.jvm.heap.max.size=32g
prod.jvm.gc.logging.enabled=false
prod.jvm.debug.enabled=false
prod.jvm.profiling.enabled=false
prod.jvm.optimization.aggressive=true
prod.jvm.security.enhanced=true

# ========================================
# Monitoring and Alerting Thresholds
# ========================================

# Memory Thresholds
memory.alert.heap.usage.warning=75
memory.alert.heap.usage.critical=90
memory.alert.metaspace.usage.warning=70
memory.alert.metaspace.usage.critical=85
memory.alert.direct.memory.usage.warning=80
memory.alert.direct.memory.usage.critical=95

# GC Thresholds
gc.alert.pause.time.warning=75ms
gc.alert.pause.time.critical=100ms
gc.alert.frequency.warning=10/min
gc.alert.frequency.critical=20/min
gc.alert.throughput.warning=95
gc.alert.throughput.critical=90

# Performance Thresholds
performance.alert.allocation.rate.warning=1gb/s
performance.alert.allocation.rate.critical=2gb/s
performance.alert.compilation.time.warning=10s
performance.alert.compilation.time.critical=30s