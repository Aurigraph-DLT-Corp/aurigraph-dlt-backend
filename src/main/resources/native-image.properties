# GraalVM Native Image Configuration for Aurigraph V11
# This file contains native image build directives for GraalVM compilation

# =========================================================================
# JDK Modules and Components - CRITICAL ForkJoinPool Configuration
# =========================================================================

# ForkJoinPool - Must initialize at runtime BEFORE compilation
# This prevents GraalVM from trying to compile static field initialization
InitializeAtRunTime=java.util.concurrent.ForkJoinPool
InitializeAtRunTime=java.util.concurrent.ForkJoinPool$Submitter
InitializeAtRunTime=java.util.concurrent.ForkJoinPool$WorkQueue
InitializeAtRunTime=java.util.concurrent.ForkJoinWorkerThread
InitializeAtRunTime=java.util.concurrent.ForkJoinWorkerThread$InnocuousForkJoinWorkerThread
InitializeAtRunTime=java.util.concurrent.ForkJoinTask
InitializeAtRunTime=java.util.concurrent.RecursiveTask
InitializeAtRunTime=java.util.concurrent.RecursiveAction

# JDK internal components
InitializeAtRunTime=java.util.concurrent.ThreadLocalRandom
InitializeAtRunTime=jdk.internal.vm.Unsafe
InitializeAtRunTime=sun.misc.Unsafe

# =========================================================================
# Unsafe and Low-level Access Configuration
# =========================================================================

# Allow access to internal unsafe operations required by ForkJoinPool
--add-opens=java.base/java.util.concurrent=ALL-UNNAMED
--add-opens=java.base/sun.misc=ALL-UNNAMED
--add-opens=java.base/java.lang=ALL-UNNAMED

# =========================================================================
# Reflection Configuration
# =========================================================================

# Enable reflection for concurrent classes
EnableAllSecurityServices=true

# =========================================================================
# JIT Compilation Directives
# =========================================================================

# Do NOT exclude Unsafe - it's needed by ForkJoinPool at runtime
# These optimizations are for specific classes
-H:-AllowIncompleteClasspath

# =========================================================================
# Performance Tuning
# =========================================================================

# Use serial GC for predictable performance in native images
-H:+UseSerialGC

# Enable optimization for startup
-H:+ReportExceptionStackTraces

# =========================================================================
# Memory Configuration
# =========================================================================

# Set maximum image heap size for compilation
-H:NativeImageHeapSize=8g

# =========================================================================
# Logging and Diagnostics
# =========================================================================

# Print relevant native image information during build
-H:+PrintClassInitialization
-H:+PrintFeatures
